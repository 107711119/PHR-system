<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <style type="text/css">
        button {
            height: 43px;
            width: 140px;
        }
        
        #mytable {
            width: 100%;
        }
        
        textarea {
            height: 800px;
            /*高度填充*/
            width: 80%;
            padding: 0;
            /*防止textarea超過td邊框*/
            vertical-align: bottom;
            /*chrome的td有margin-top情況 用此CSS調整*/
            /*border: none; /*border用td的*/
        }
    </style>
    <script src="setting.js"></script>
    <script src="HTTP2019.js"></script>
    <script>
        var con1fever = {
            "resourceType": "Condition",
            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "386661006",
                    "display": "Fever"
                }],
                "text": " Fever"
            },
            "bodySite": [{
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "386661006",
                    "display": "Entire body as a whole"
                }]
            }],
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-12-01T00:00:00",
        }

        var con2headache = {
            "resourceType": "Condition",

            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "25064002",
                    "display": "Headache"
                }],
                "text": "Headache"
            },
            "bodySite": [{
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "38266002",
                    "display": "Entire body as a whole"
                }]
            }],
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-02-07T13:28:17",
        }

        var con3fatigue = {
            "resourceType": "Condition",

            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "84229001",
                    "display": "Fatigue"
                }],
                "text": " Fatigue"
            },
            "bodySite": [{
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "84229001",
                    "display": "Entire body as a whole"
                }]
            }],
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-02-07T13:28:17",
        }

        var con4musclepain = {
            "resourceType": "Condition",

            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "68962001",
                    "display": "Muscle pain"
                }],
                "text": "Muscle pain"
            },
            "bodySite": [{
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "84229001",
                    "display": "Entire body as a whole"
                }]
            }],
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-02-07T13:28:17",
        }

        var con5nv = {
            "resourceType": "Condition",

            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "16932000",
                    "display": "Nausea and vomiting "
                }],
                "text": "Nausea and vomiting噁心嘔吐"
            },
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-02-07T13:28:17",
        }

        var con6ms = {
            "resourceType": "Condition",

            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "25064002",
                    "display": "Muscle stiffness"
                }],
                "text": "全身痠痛"
            },
            "bodySite": [{
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "84229001",
                    "display": "Entire body as a whole"
                }]
            }],
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-02-07T13:28:17",
        }

        var con7chill = {
            "resourceType": "Condition",

            "severity": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "255604002",
                    "display": "Mild"
                }]
            },
            "code": {
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "43724002",
                    "display": "Chill"
                }],
                "text": "冷顫"
            },
            "bodySite": [{
                "coding": [{
                    "system": "http://snomed.info/sct",
                    "code": "84229001",
                    "display": "Entire body as a whole"
                }]
            }],
            "subject": {
                "reference": "Patient/1563",
                "display": ""
            },
            "onsetDateTime": "2015-02-07T13:28:17",
        }

        var questionnaireObj = {
            "resourceType": "QuestionnaireResponse",
            "status": "completed",
            "subject": {
                "reference": "Patient/"
            },
            "authored": "2020-02-17T12:20:17.1151Z",
            "item": [{
                "linkId": "1",
                "text": "介面層次清晰",
                "answer": [{
                    //"disply": "非常滿意",
                    "valueInteger": 5
                }]
            }, {
                "linkId": "2",
                "text": "閱讀、排版形式優良",
                "answer": [{
                    "valueInteger": 0
                }]
            }, {
                "linkId": "3",
                "text": "符合需求",
                "answer": [{
                    "valueInteger": 0
                }]
            }, {
                "linkId": "4",
                "text": "綜合評分",
                "answer": [{
                    "valueInteger": 0
                }]
            }]
        };


        function postcon1fever() {

            if (document.getElementById("Con1").checked == true) {
                var subRef = "Patient/";
                con1fever.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con1fever.subject.display = document.getElementById("name").value;*/
                con1fever.code.coding[0].code = "386661006";
                con1fever.code.coding[0].display = "Fever";
                con1fever.code.text = "發燒";
                con1fever.onsetDateTime = document.getElementById("ctime1").value + ":00";
                alert(document.getElementById("ctime1").value);

                var jsonStr = JSON.stringify(con1fever);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postcon2headache() {

            if (document.getElementById("Con2").checked == true) {
                var subRef = "Patient/";
                con2headache.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con2headache.subject.display = document.getElementById("name").value;*/
                con2headache.code.coding[0].code = "25064002";
                con2headache.code.coding[0].disply = "Headache";
                con2headache.code.text = "頭痛";
                con2headache.onsetDateTime = document.getElementById("ctime2").value + ":00";
                if (document.getElementById("Con1Mild").checked == true) {
                    con2headache.severity.coding[0].code = "Mild";
                    con2headache.severity.coding[0].display = "Mild";
                }
                if (document.getElementById("Con1Moderate").checked == true) {
                    con2headache.severity.coding[0].code = "Moderate";
                    con2headache.severity.coding[0].display = "Moderate";
                }
                if (document.getElementById("Con1Severe").checked == true) {
                    con2headache.severity.coding[0].code = "Severe";
                    con2headache.severity.coding[0].display = "Severe";
                }

                var jsonStr = JSON.stringify(con2headache);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postcon3fatigue() {
            if (document.getElementById("Con3").checked == true) {
                var subRef = "Patient/";
                con3fatigue.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con3fatigue.subject.display = document.getElementById("name").value;*/
                con3fatigue.code.coding[0].code = "84229001";
                con3fatigue.code.coding[0].display = "Fatigue";
                con3fatigue.code.text = "疲倦";
                con3fatigue.onsetDateTime = document.getElementById("ctime3").value + ":00";

                var jsonStr = JSON.stringify(con3fatigue);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postcon4musclepain() {

            if (document.getElementById("Con4").checked == true) {
                var subRef = "Patient/";
                con4musclepain.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con4musclepain.subject.display = document.getElementById("name").value;*/
                con4musclepain.code.coding[0].code = "68962001";
                con4musclepain.code.coding[0].disply = "Muscle pain";
                con4musclepain.code.text = "肌肉痛";
                con4musclepain.onsetDateTime = document.getElementById("ctime4").value + ":00";
                if (document.getElementById("Con4Mild").checked == true) {
                    con4musclepain.severity.coding[0].code = "Mild";
                    con4musclepain.severity.coding[0].display = "Mild";
                }
                if (document.getElementById("Con4Moderate").checked == true) {
                    con4musclepain.severity.coding[0].code = "Moderate";
                    con4musclepain.severity.coding[0].display = "Moderate";
                }
                if (document.getElementById("Con4Severe").checked == true) {
                    con4musclepain.severity.coding[0].code = "Severe";
                    con4musclepain.severity.coding[0].display = "Severe";
                }

                var jsonStr = JSON.stringify(con4musclepain);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postcon5nv() {
            if (document.getElementById("Con5").checked == true) {
                var subRef = "Patient/";
                con5nv.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con5nv.subject.display = document.getElementById("name").value;*/
                con5nv.code.coding[0].code = "16932000";
                con5nv.code.coding[0].display = "Nausea and vomiting";
                con5nv.code.text = "噁心嘔吐";
                con5nv.onsetDateTime = document.getElementById("ctime5").value + ":00";

                var jsonStr = JSON.stringify(con5nv);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postcon6ms() {
            if (document.getElementById("Con6").checked == true) {
                var subRef = "Patient/";
                con6ms.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con6ms.subject.display = document.getElementById("name").value;*/
                con6ms.code.coding[0].code = "25064002";
                con6ms.code.coding[0].display = "Muscle stiffness";
                con6ms.code.text = "全身痠痛";
                con6ms.onsetDateTime = document.getElementById("ctime6").value + ":00";

                var jsonStr = JSON.stringify(con6ms);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postcon7chill() {
            if (document.getElementById("Con7").checked == true) {
                var subRef = "Patient/";
                con7chill.subject.reference = subRef + document.getElementById("patientid1").value;
                /*con7chill.subject.display = document.getElementById("name").value;*/
                con7chill.code.coding[0].code = "43724002";
                con7chill.code.coding[0].display = "Chill";
                con7chill.code.text = "冷顫";
                con7chill.onsetDateTime = document.getElementById("ctime7").value + ":00";

                var jsonStr = JSON.stringify(con7chill);
                alert(jsonStr);

                var apiURL;
                apiURL = FHIRrootURL + '/' + "Condition";
                HTTPPostData(apiURL, jsonStr);
            }
        }

        function postQuestionnaire() {

            var subRef = "Patient/";
            questionnaireObj.subject.reference = subRef + document.getElementById("patientid3").value;

            //介面層次清晰
            if (document.getElementById("rd_speed_1_5").checked == true) {
                questionnaireObj.item[0].answer[0].valueInteger = document.getElementById("rd_speed_1_5").value;
                //myObj.item[0].answer[0].valueInteger = 4;
                //myObj.item[0].answer[0].disply = document.getElementById("rd_speed_1_5").value;  x
            }
            if (document.getElementById("rd_speed_1_4").checked == true) {
                questionnaireObj.item[0].answer[0].valueInteger = 4;
            }
            if (document.getElementById("rd_speed_1_3").checked == true) {
                questionnaireObj.item[0].answer[0].valueInteger = 3;
            }
            if (document.getElementById("rd_speed_1_2").checked == true) {
                questionnaireObj.item[0].answer[0].valueInteger = 2;
            }
            if (document.getElementById("rd_speed_1_1").checked == true) {
                questionnaireObj.item[0].answer[0].valueInteger = 1;
            }


            //2.閱讀
            if (document.getElementById("rd_visual_2_5").checked == true) {
                questionnaireObj.item[1].answer[0].valueInteger = document.getElementById("rd_visual_2_5").value;
            }
            if (document.getElementById("rd_visual_2_4").checked == true) {
                questionnaireObj.item[1].answer[0].valueInteger = 4;
            }
            if (document.getElementById("rd_visual_2_3").checked == true) {
                questionnaireObj.item[1].answer[0].valueInteger = 3;
            }
            if (document.getElementById("rd_visual_2_2").checked == true) {
                questionnaireObj.item[1].answer[0].valueInteger = 2;
            }
            if (document.getElementById("rd_visual_2_1").checked == true) {
                questionnaireObj.item[1].answer[0].valueInteger = 1;
            }

            //3.需求
            if (document.getElementById("rd_need_3_5").checked == true) {
                questionnaireObj.item[2].answer[0].valueInteger = document.getElementById("rd_need_3_5").value;
            }
            if (document.getElementById("rd_need_3_4").checked == true) {
                questionnaireObj.item[2].answer[0].valueInteger = 4;
            }
            if (document.getElementById("rd_need_3_3").checked == true) {
                questionnaireObj.item[2].answer[0].valueInteger = 3;
            }
            if (document.getElementById("rd_need_3_2").checked == true) {
                questionnaireObj.item[2].answer[0].valueInteger = 2;
            }
            if (document.getElementById("rd_need_3_1").checked == true) {
                questionnaireObj.item[2].answer[0].valueInteger = 1;
            }


            //4.綜合 
            if (document.getElementById("rd_sum_4_5").checked == true) {
                questionnaireObj.item[3].answer[0].valueInteger = document.getElementById("rd_sum_4_5").value;
            }
            if (document.getElementById("rd_sum_4_4").checked == true) {
                questionnaireObj.item[3].answer[0].valueInteger = 4;
            }
            if (document.getElementById("rd_sum_4_3").checked == true) {
                questionnaireObj.item[3].answer[0].valueInteger = 3;
            }
            if (document.getElementById("rd_sum_4_2").checked == true) {
                questionnaireObj.item[3].answer[0].valueInteger = 2;
            }
            if (document.getElementById("rd_sum_4_1").checked == true) {
                questionnaireObj.item[3].answer[0].valueInteger = 1;
            }


            var jsonStr = JSON.stringify(questionnaireObj); //將myObj中的內容轉換成JSON格式
            alert(jsonStr);

            var apiURL;
            apiURL = FHIRrootURL + "/QuestionnaireResponse";
            HTTPPostData(apiURL, jsonStr); //將網址及轉成JSON格式的myObj傳入副函式中(在HTTR2019.js中)

        }

        function clearQuestionnaire() {
            var Total_Obj = document.getElementsByTagName("input");
            // var question=document.getElementsByName("qtext");
            for (var k = 0; k < Total_Obj.length; k++) {
                if (Total_Obj[k].type == "radio") {
                    if (Total_Obj[k].checked) {
                        Total_Obj[k].checked = false; //將所有radio改成未選擇的狀態
                    }
                }
            }
        }

        var allowCreate = 0; //allowCreate=3 to enable create button
        /*if (localStorage.getItem("bundleID") != null) {
            document.getElementById("taBundle").value = localStorage.getItem("taBundle");
        }*/

        /*let urlParams = new URLSearchParams(window.location.search);
        document.getElementById("patientid1").innerHTML = urlParams.get('patientid');*/

        function searchBundle() {
            var bunid = document.getElementById("bundleID").value;
            var apiURL = FHIRrootURL + '/Bundle/' + bunid;
            //clearAllTextbox();
            HTTPGetData(apiURL, manageResponseRet, 1)
        }

        function manageResponseRet() {
            document.getElementById("taBundle").value = ret;
            //var aa = document.getElementById("bundleID").value;
            //document.getElementById("bundleID").value = ret;

            if (JSON.parse(ret).id != aa) {
                alert("Bundle not found!");
            } else {
                //allowCreate++;
                document.getElementById("bundleID").value = JSON.parse(ret).id;
                //localStorage.setItem("fhirImmun", ret);

                //get patient ID and resource
                //var idFHIR = JSON.parse(ret).patient.reference;
                //var apiURL = FHIRrootURL + '/' + idFHIR;
                //HTTPGetData(apiURL, manageResponseRet, 2);
                //window.open(".html");
            }
        }
    </script>
</head>

<body style="height:780px">
    <p>
        <h1><b><center>PHR System</center></b></h1>
    </p>
    <table id="mytable">
        <!--<table id="mytable" style="border:3px #FFAC55 dashed;padding:5px;" rules="all" cellpadding='5' ;>-->
        <tr>
            <td>
                &nbsp;<b>Create Condition</b><br><br>
            </td>
            <td>
                &nbsp;<b>Get Bundle</b><br><br>
            </td>
            <td>
                &nbsp;<b>Create Questitionnaire</b><br><br>
            </td>
        </tr>
        <tr>
            <td>
                PatientID：
                <input type="text" id="patientid1">
            </td>
            <td>
                BundleID：
                <input type="text" id="bundleID">
                <input type="button" id="btnsearchbundle" onclick="searchBundle()" value="Enter">
            </td>
            <td>PatientID：
                <input type="text" id="patientid3">
            </td>
        </tr>
        <tr>
            <td>
                <br><input type="checkbox" id="Con1" name="fever" value="386661006">&nbsp;發燒：&nbsp;
                <input type="number" max="45.0" min="37.0" step="0.1" name="feverdegree">度&nbsp;&nbsp;
                <p>發生時間：<input type="datetime-local" id="ctime1">
                    <br><br><input id="Button1" onclick="postcon1fever()" type="button" value="postData" /></p>
            </td>
            <td rowspan="5">
                <br><textarea id="taBundle"></textarea>
            </td>
            <td>
                1.此介面層次清晰
                <div>
                    <input type="radio" name="rd_speed" id="rd_speed_1_5" value="5" text="非常滿意" />5 非常滿意&nbsp;&nbsp;
                    <br><input type="radio" name="rd_speed" id="rd_speed_1_4" value="4" />4 滿意&nbsp;&nbsp;
                    <br><input type="radio" name="rd_speed" id="rd_speed_1_3" value="3" />3 普通&nbsp;&nbsp;
                    <br><input type="radio" name="rd_speed" id="rd_speed_1_2" value="2" />2 不滿意&nbsp;&nbsp;
                    <br><input type="radio" name="rd_speed" id="rd_speed_1_1" value="1" />1 非常不滿意&nbsp;&nbsp;
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <input type="checkbox" id="Con2" name="headache" value="25064002">&nbsp;頭痛:&nbsp;&nbsp; 嚴重程度:
                <input id="Con1Mild" type="radio" name="severity" value="Mild">輕度 &nbsp;
                <input id="Con1Moderate" type="radio" name="severity" value="Moderate"> 中度&nbsp;
                <input id="Con1Severe" type="radio" name="severity" value="Severe"> 重度 &nbsp;&nbsp;
                <p>發生時間: <input type="datetime-local" id="ctime2">
                    <br><br><input id="Button2" onclick="postcon2headache()" type="button" value="postData" /></p>
            </td>
            <td>
                2.閱讀、排版形式優良
                <div>
                    <input type="radio" name="rd_visual" id="rd_visual_2_5" value="5" text="非常滿意" />5非常滿意
                    <br><input type="radio" name="rd_visual" id="rd_visual_2_4" value="4" />4 滿意
                    <br><input type="radio" name="rd_visual" id="rd_visual_2_3" value="3" />3 普通
                    <br><input type="radio" name="rd_visual" id="rd_visual_2_2" value="2" />2 不滿意
                    <br><input type="radio" name="rd_visual" id="rd_visual_2_1" value="1" />1 非常不滿意
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <input type="checkbox" id="Con3" name="fatigue" value="84229001">疲倦&nbsp;&nbsp;
                <p>發生時間： <input type="datetime-local" id="ctime3">
                    <br><br><input id="Button3" onclick="postcon3fatigue()" type="button" value="postData" /></p>
            </td>
            <td>
                3.符合需求
                <div>
                    <input type="radio" name="rd_need" id="rd_need_3_5" value="5" text="非常滿意" />5非常滿意
                    <br><input type="radio" name="rd_need" id="rd_need_3_4" value="4" />4 滿意
                    <br><input type="radio" name="rd_need" id="rd_need_3_3" value="3" />3 普通
                    <br><input type="radio" name="rd_need" id="rd_need_3_2" value="2" />2 不滿意
                    <br><input type="radio" name="rd_need" id="rd_need_3_1" value="1" />1 非常不滿意
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <input type="checkbox" id="Con4" name="musclepain" value="68962001">肌肉痛&nbsp;&nbsp; 嚴重程度:
                <input id="Con4Mild" type="radio" name="severity" value="Mild">輕度 &nbsp;
                <input id="Con4Moderate" type="radio" name="severity" value="Moderate"> 中度&nbsp;
                <input id="Con4Severe" type="radio" name="severity" value="Severe"> 重度 &nbsp;&nbsp;
                <p>發生時間： <input type="datetime-local" id="ctime4">
                    <br><br><input id="Button4" onclick="postcon4musclepain()" type="button" value="postData" /></p>
            </td>
            <td>
                4.綜合評分
                <div>
                    <input type="radio" name="rd_sum" id="rd_sum_4_5" value="5" text="非常滿意" />5非常滿意
                    <br><input type="radio" name="rd_sum" id="rd_sum_4_4" value="4" />4 滿意
                    <br><input type="radio" name="rd_sum" id="rd_sum_4_3" value="3" />3 普通
                    <br><input type="radio" name="rd_sum" id="rd_sum_4_2" value="2" />2 不滿意
                    <br><input type="radio" name="rd_sum" id="rd_sum_4_1" value="1" />1 非常不滿意
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <input type="checkbox" id="Con5" name="Nausea and vomiting" value="16932000">噁心嘔吐&nbsp;&nbsp;
                <p>發生時間: <input type="datetime-local" id="ctime5">
                    <br><br><input id="Button5" onclick="postcon5nv()" type="button" value="postData" /></p>
            </td>
            <td>
                <input id="Button1" onclick="postQuestionnaire()" type="button" value="postData" />&emsp;&emsp;
                <input id="btnClear" onclick="clearQuestionnaire" type="button" value="clearData" />
            </td>
        </tr>
        <tr>
            <td>
                <input type="checkbox" id="Con6" name="Muscle stiffness" value="25064002">全身痠痛&nbsp;&nbsp;
                <p>發生時間: <input type="datetime-local" id="ctime6">
                    <br><br><input id="Button6" onclick="postcon6ms()" type="button" value="postData" /></p>
            </td>
            <td></td>
        </tr>
        <tr>
            <td>
                <input type="checkbox" id="Con7" name="Chill" value="43724002">冷顫&nbsp;&nbsp;
                <p>發生時間: <input type="datetime-local" id="ctime7">
                    <br><br><input id="Button7" onclick="postcon7chill()" type="button" value="postData" /></p>
            </td>
            <td></td>
        </tr>
    </table>

</body>

</html>